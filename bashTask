- task: Bash@3
  displayName: Run EF Core Migration Bundle (Linux)
  inputs:
    targetType: 'inline'
    script: |
      bundlePath="$(System.DefaultWorkingDirectory)/_AHS Mobile Sync Web API/drop/EFBundle/bundle"
      echo "Running EF migration bundle: $bundlePath"

      if [ ! -f "$bundlePath" ]; then
        echo "❌ Bundle not found at $bundlePath"
        exit 1
      fi

      chmod +x "$bundlePath"

      if [ -z "$DDLConnection" ]; then
        echo "❌ DDLConnection variable is not set"
        exit 1
      fi

      echo "Using connection string: $DDLConnection"
      "$bundlePath" --connection "$DDLConnection"
      result=$?

      if [ $result -ne 0 ]; then
        echo "❌ EF migration bundle failed with exit code $result"
        exit $result
      else
        echo "✅ EF migration applied successfully"
      fi
